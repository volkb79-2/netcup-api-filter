// this is JSONC format, so you can add comments
{
  // Display name in VS Code UI (includes username for uniqueness)
  //"name": "${localWorkspaceFolderBasename}-devcontainer-${localEnv:USER}",
  "name": "naf-devcontainer-${localEnv:USER}",
  "build": {
    "dockerfile": "Dockerfile"
  },
  "features": {
    "ghcr.io/devcontainers/features/docker-outside-of-docker:1": {
      "moby": false,
      "dockerDashComposeVersion": "v2"
    }
  },
  "workspaceFolder": "/workspaces/${localWorkspaceFolderBasename}",
  "remoteUser": "vscode",
  "mounts": [
    // Mount Docker socket for container management
    "source=/var/run/docker.sock,target=/var/run/docker.sock,type=bind",
    // Mount SSH keys for Git access
    "source=${localEnv:HOME}/.ssh,target=/home/vscode/.ssh-host,type=bind,consistency=cached"
  ],
  "containerEnv": {
    "DOCKER_HOST": "unix:///var/run/docker.sock"
  },
  "runArgs": [
    // Set container hostname (used by validation scripts)
    "--hostname", "${localWorkspaceFolderBasename}-devcontainer-${localEnv:USER}",
    // Set Docker container name (visible in docker ps)
    "--name", "${localWorkspaceFolderBasename}-devcontainer-${localEnv:USER}",
    // Enable FUSE for sshfs support
    "--cap-add", "SYS_ADMIN",
    "--device", "/dev/fuse",
    // Relax Docker security profiles so fusermount3 can call mount(2)
    "--security-opt", "apparmor=unconfined",
    "--security-opt", "seccomp=unconfined"
  ],
  "postCreateCommand": "bash .devcontainer/post-create.sh",
  "customizations": {
    "vscode": {
      "settings": {
        "terminal.integrated.defaultProfile.linux": "bash",
        "python.defaultInterpreterPath": "/usr/local/bin/python3.13"
      },
      "extensions": [
        "ms-python.python",
        "ms-python.black-formatter",
        "ms-vscode.docker",
        "redhat.vscode-yaml",
        "tamasfe.even-better-toml",
        "samuelcolvin.jinjahtml",
        "github.vscode-github-actions"
      ]
    }
  }
}

