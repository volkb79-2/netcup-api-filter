# ============================================================================
# Service Names Configuration (Central Source of Truth)
# ============================================================================
# Purpose: Define all service/container names in one place
# Used by: docker-compose.yml, nginx configs, Python code, shell scripts
# 
# Naming Convention: ${PROJECT_TAG}-${ENV_TAG}-{service}
# - PROJECT_TAG: Project identifier (naf = netcup-api-filter)
# - ENV_TAG: Environment (dev, staging, prod)
# - service: Service function (mailpit, reverse-proxy, etc.)
# 
# CRITICAL: Source this file before using service names:
#   source .env.services
# 
# NOTE: Variables are exported to make them available to child processes
# (envsubst, docker compose, Python scripts, etc.)
# ============================================================================

# Project identification (inherited from .env.workspace)
PROJECT_TAG="${PROJECT_TAG:-naf}"
ENV_TAG="${ENV_TAG:-dev}"

# ============================================================================
# Service/Container Names
# ============================================================================
# Used as both:
# - Service name in docker-compose.yml (for 'docker compose' commands)
# - Container name via container_name directive (for 'docker ps')
# 
# Since we set explicit container_name in all docker-compose files,
# service name = container name (no need for separate variables)

# Playwright browser automation
SERVICE_PLAYWRIGHT="${PROJECT_TAG}-${ENV_TAG}-playwright"
SERVICE_PLAYWRIGHT_CERT_GEN="${PROJECT_TAG}-${ENV_TAG}-playwright-cert-gen"

# SMTP testing
SERVICE_MAILPIT="${PROJECT_TAG}-${ENV_TAG}-mailpit"

# Mock services
SERVICE_MOCK_NETCUP_API="${PROJECT_TAG}-${ENV_TAG}-mock-netcup-api"
SERVICE_MOCK_GEOIP="${PROJECT_TAG}-${ENV_TAG}-mock-geoip"

# TLS reverse proxy
SERVICE_REVERSE_PROXY="${PROJECT_TAG}-${ENV_TAG}-reverse-proxy"

# ============================================================================
# Service Hostnames (Docker DNS)
# ============================================================================
# Docker DNS resolves container names to IPs within a network
# Use these for inter-service communication (e.g., nginx â†’ mailpit)

HOSTNAME_PLAYWRIGHT="${SERVICE_PLAYWRIGHT}"
HOSTNAME_MAILPIT="${SERVICE_MAILPIT}"
HOSTNAME_MOCK_NETCUP_API="${SERVICE_MOCK_NETCUP_API}"
HOSTNAME_MOCK_GEOIP="${SERVICE_MOCK_GEOIP}"
HOSTNAME_REVERSE_PROXY="${SERVICE_REVERSE_PROXY}"

# ============================================================================
# Service URLs (Client Connections)
# ============================================================================
# Full URLs for client connections (tests, Python code, nginx upstream)

# Mailpit (SMTP testing UI + API)
MAILPIT_URL="http://${HOSTNAME_MAILPIT}:8025/mailpit"
MAILPIT_API_URL="${MAILPIT_URL}/api/v1"

# Mock Netcup API
MOCK_NETCUP_API_URL="http://${HOSTNAME_MOCK_NETCUP_API}"

# Mock GeoIP API
MOCK_GEOIP_API_URL="http://${HOSTNAME_MOCK_GEOIP}"

# ============================================================================
# Export for Child Processes
# ============================================================================
# CRITICAL: export makes variables available to:
# - envsubst (nginx template rendering)
# - docker compose (reads env vars for substitution)
# - Python scripts (os.environ.get())
# - Any subprocess spawned from scripts that source this file
# 
# Without export: Variables only available in current shell
# With export: Variables available in current shell + all child processes

export PROJECT_TAG ENV_TAG
export SERVICE_PLAYWRIGHT SERVICE_PLAYWRIGHT_CERT_GEN SERVICE_MAILPIT
export SERVICE_MOCK_NETCUP_API SERVICE_MOCK_GEOIP SERVICE_REVERSE_PROXY
export HOSTNAME_PLAYWRIGHT HOSTNAME_MAILPIT HOSTNAME_MOCK_NETCUP_API
export HOSTNAME_MOCK_GEOIP HOSTNAME_REVERSE_PROXY
export MAILPIT_URL MAILPIT_API_URL
export MOCK_NETCUP_API_URL MOCK_GEOIP_API_URL
