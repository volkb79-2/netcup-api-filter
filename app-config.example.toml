# =============================================================================
# APP-CONFIG.TOML - INITIAL DEPLOYMENT CONFIGURATION
# =============================================================================
# Purpose: Override default settings on first application start
# Usage: Copy to app-config.toml and customize before deployment
# Documentation: see `docs/TOML_CONFIGURATION.md`
# 
# IMPORTANT:
# - This file is read ONCE on first application start
# - Values are written to Settings table in database
# - File is automatically DELETED after successful import
# - Subsequent changes must be made via admin UI
#
# Configuration Hierarchy (highest priority first):
# 1. Environment variables (runtime overrides)
# 2. Settings table (admin UI changes)
# 3. app-config.toml (initial deployment config) ‚Üê YOU ARE HERE
# 4. .env/.env.defaults (env-file defaults)
#
# =============================================================================

# =============================================================================
# INITIAL SETUP (ACCOUNTS)
# =============================================================================
# Admins are regular accounts with `is_admin = true`.
# Define at least one admin via [[users]] for deterministic first-run seeding.

# [[users]]
# username = "admin"                    # Login username
# email = "admin@example.com"            # Recipient for email-based 2FA and password reset
# password = "CHANGE_ME_STRONG_PASSWORD" # Or "generate" to auto-generate (shown once in logs)
# is_approved = true                      # Auto-approve (skip admin approval workflow)
# must_change_password = false            # Force change on first login?
# is_admin = true                         # Admin account (can log into admin console)

# =============================================================================
# RATE LIMITING
# =============================================================================
# Format: "<number> per <unit>" (e.g., "10 per minute", "100 per hour")
# Protects against brute-force attacks and API abuse
[rate_limits]
admin = "50 per minute"      # Admin portal rate limit
account = "50 per minute"    # Account portal rate limit
api = "60 per minute"        # API endpoints rate limit

# =============================================================================
# SECURITY SETTINGS
# =============================================================================
[security]
password_reset_expiry_hours = 1   # Password reset link validity (hours)
invite_expiry_hours = 48          # Account invite link validity (hours)

# =============================================================================
# SESSION CONFIGURATION (NEW)
# =============================================================================
# Flask session settings - can also be set via FLASK_SESSION_* env vars
# Uncomment to override .env.defaults values
# [session]
# cookie_secure = "auto"       # true, false, or "auto" (detects HTTPS)
# cookie_httponly = true       # Prevent JavaScript access to cookies
# cookie_samesite = "Lax"      # CSRF protection: Strict, Lax, or None
# lifetime_seconds = 3600      # Session timeout in seconds (3600 = 1 hour)

# =============================================================================
# ADMIN SECURITY CONFIGURATION (NEW)
# =============================================================================
# Additional security for admin portal
# Uncomment to enable IP restrictions
# [admin]
# ip_whitelist = ["192.168.1.0/24", "10.0.0.1"]  # IPs/CIDRs allowed access
# bind_session_to_ip = true   # Bind sessions to originating IP
# require_2fa = true          # Require 2FA for admin accounts (recommended)

# =============================================================================
# LOGGING CONFIGURATION (NEW)
# =============================================================================
# Control application logging behavior
# Uncomment to override defaults
# [logging]
# level = "INFO"              # DEBUG, INFO, WARNING, ERROR, CRITICAL
# max_size_mb = 10            # Log file size before rotation
# backup_count = 5            # Number of backup files to keep

# =============================================================================
# NOTIFICATION SETTINGS (NEW)
# =============================================================================
# Email notifications sent to admin
# Uncomment to configure admin alerts
# [notifications]
# admin_email = "admin@example.com"   # Admin notification recipient
# notify_new_account = true           # Email on new user registrations
# notify_realm_request = true         # Email on realm access requests
# notify_security_events = true       # Email on security alerts
# notify_token_expiring_days = 7      # Days before token expiry to notify

# =============================================================================
# SMTP CONFIGURATION (Email Settings)
# =============================================================================
# Leave commented for initial setup via admin UI
# Uncomment and configure for automated deployment
[smtp]
smtp_host = "mxe98f.netcup.net"
smtp_port = 465
smtp_security = "ssl"           # "ssl" (465), "tls" (587), or "none" (25)
smtp_username = "dstdns@vxxu.de"
smtp_password = ""
from_email = "dstdns@vxxu.de"
from_name = "Netcup API Filter"

# GeoIP Configuration (MaxMind)
# Leave commented to disable GeoIP lookups
# Uncomment and configure to enable
# Get credentials: https://www.maxmind.com/en/geolite2/signup
[geoip]
account_id = "YOUR_MAXMIND_ACCOUNT_ID"  # e.g., "1234567"
license_key = "YOUR_MAXMIND_LICENSE_KEY"
api_url = "https://geoip.maxmind.com"  # Optional, uses default if not set
edition_ids = "GeoLite2-ASN GeoLite2-City GeoLite2-Country"

# =============================================================================
# BACKEND SERVICES - DNS Provider Credentials
# =============================================================================
# Define multiple backend services (admin can have multiple Netcup accounts, PowerDNS instances)
# Each backend is created as a BackendService in the database

# Platform-owned Netcup account (example - primary account)
# Get API credentials from Netcup CCP: https://ccp.netcup.net
[[backends]]
service_name = "platform-netcup-primary"
provider = "netcup"
owner = "platform"  # "platform" or username for user-owned
display_name = "Platform Netcup (Primary)"
config = { customer_id = "YOUR_CUSTOMER_ID", api_key = "YOUR_API_KEY", api_password = "YOUR_API_PASSWORD", api_url = "https://ccp.netcup.net/run/webservice/servers/endpoint.php?JSON", timeout = 30 }

# Platform-owned Netcup account (example - secondary account for different zones)
# [[backends]]
# service_name = "platform-netcup-secondary"
# provider = "netcup"
# owner = "platform"
# display_name = "Platform Netcup (Secondary)"
# config = { customer_id = "...", api_key = "...", api_password = "..." }

# Platform-owned PowerDNS instance
[[backends]]
service_name = "platform-powerdns"
provider = "powerdns"
owner = "platform"
display_name = "Platform PowerDNS"
# Use "${POWERDNS_API_URL}" and "${POWERDNS_API_KEY}" to reference environment variables.
# NOTE: deploy builds render these placeholders into a self-contained app-config.toml.
config = { api_url = "${POWERDNS_API_URL}", api_key = "${POWERDNS_API_KEY}", server_id = "localhost" }

# User-owned backend example (requires user to exist - see [[users]] section)
# [[backends]]
# service_name = "user-alice-netcup"
# provider = "netcup"
# owner = "alice"  # Username (must be defined in [[users]] section)
# display_name = "Alice's Netcup Account"
# config = { customer_id = "...", api_key = "...", api_password = "..." }

# =============================================================================
# DOMAIN ROOTS - DNS Zones Managed by Backends
# =============================================================================
# Define which DNS zones are managed by which backends
# Each domain root is created as a ManagedDomainRoot in the database

# Free DDNS domain on PowerDNS
[[domain_roots]]
backend = "platform-powerdns"  # References backends.service_name
domain = "powerhosts.vxxu.de"
dns_zone = "powerhosts.vxxu.de"  # Actual zone name in backend (usually same as domain)
visibility = "public"  # "public" (free DDNS), "private" (admin only), "invite" (invite-only)
display_name = "Free PowerDNS DDNS"
description = "Public DDNS domain - users can create hosts without approval"
allow_apex_access = false  # Can users request access to apex (powerhosts.vxxu.de itself)?
min_subdomain_depth = 1    # Minimum depth: 1 = host.powerhosts.vxxu.de
max_subdomain_depth = 3    # Maximum depth: 3 = a.b.c.powerhosts.vxxu.de
allowed_record_types = ["A", "AAAA", "CNAME", "TXT"]  # Null = all allowed
allowed_operations = ["read", "create", "update", "delete"]  # Null = all allowed
max_hosts_per_user = 5     # Quota for public domains
require_email_verification = true

# Private domain on Netcup (admin-controlled)
# [[domain_roots]]
# backend = "platform-netcup-primary"
# domain = "internal.example.com"
# visibility = "private"
# display_name = "Internal Zone"
# description = "Admin-only DNS zone for internal services"

# =============================================================================
# USER PRESEEDING (Optional)
# =============================================================================
# Define users to create on first deployment (useful for user-owned backends)
# Each user is created as an Account in the database

# TIP: Prefer creating a small set of known test users here for production-parity
# testing (webhosting/live), rather than relying on ad-hoc UI creation.
# The app reads this file once on first start, writes users to the DB, and then
# deletes the file.

# Example user with explicit password (for deterministic testing)
# [[users]]
# username = "naf-user"                  # Login username
# email = "naf-user@vxxu.de"             # Recipient for email-based 2FA and password reset
# password = "CHANGE_ME_STRONG_PASSWORD" # Or "generate" to auto-generate (shown once in logs)
# is_approved = true                      # Auto-approve (skip admin approval workflow)
# must_change_password = false            # Force change on first login?
# is_admin = false                        # Optional: true = admin account (can log into admin console)

# Example user with generated password (copy from logs on first start)
# [[users]]
# username = "naf-user2"
# email = "naf-user2@vxxu.de"
# password = "generate"
# is_approved = true
# must_change_password = true

# =============================================================================
# TESTING CONFIGURATION
# =============================================================================
# For local development/testing with mock services
# Uncomment to override service endpoints
#
# [smtp]
# smtp_host = "naf-mailpit"        # Mailpit container (see tooling/mailpit/)
# smtp_port = 1025                 # Mailpit SMTP port (no auth)
# smtp_security = "none"
# from_email = "test@localhost"
#
# [geoip]
# api_url = "http://naf-mock-geoip:5556"  # Mock GeoIP (see tooling/geoip-mock/)
#
# [netcup]
# api_url = "http://naf-mock-netcup-api:5558"  # Mock Netcup API (tooling/netcup-api-mock/)
# =============================================================================
