{# Reset Password Page #}
{% extends "standalone_base.html" %}

{% block title %}Reset Password - Netcup API Filter{% endblock %}

{% block icon %}bi-key{% endblock %}

{% block heading %}Reset Password{% endblock %}

{% block form_content %}
<p class="text-center text-muted mb-4">
    Enter your new password below.
</p>

<form action="{{ url_for('account.reset_password', token=token) }}" method="post" id="reset-form">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    
    <div class="mb-3">
        <label for="password" class="form-label">New Password</label>
        <div class="input-group">
            <span class="input-group-text">
                <i class="bi bi-lock"></i>
            </span>
            <input type="password" class="form-control" id="password" name="password" 
                   minlength="8" required>
            <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('password')">
                <i class="bi bi-eye"></i>
            </button>
        </div>
        
        <!-- Password Strength Meter -->
        <div class="mt-2">
            <div class="progress" style="height: 4px;">
                <div class="progress-bar" role="progressbar" id="strength-bar" 
                     style="width: 0%"></div>
            </div>
            <small class="text-muted" id="strength-text">Enter a password</small>
        </div>
    </div>

    <div class="mb-4">
        <label for="confirm-password" class="form-label">Confirm Password</label>
        <div class="input-group">
            <span class="input-group-text">
                <i class="bi bi-lock-fill"></i>
            </span>
            <input type="password" class="form-control" id="confirm-password" 
                   name="confirm_password" required>
            <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('confirm-password')">
                <i class="bi bi-eye"></i>
            </button>
        </div>
        <div class="invalid-feedback" id="match-error">Passwords do not match</div>
    </div>

    <div class="d-grid">
        <button type="submit" class="btn btn-primary" id="submit-btn">
            <i class="bi bi-check-lg me-1"></i>Reset Password
        </button>
    </div>
</form>
{% endblock %}

{% block footer_links %}
<p class="text-muted">
    Remember your password?
    <a href="{{ url_for('account.login') }}" class="text-decoration-none">Sign in</a>
</p>
{% endblock %}

{% block extra_scripts %}
<script>
// Password strength checker
document.getElementById('password').addEventListener('input', function() {
    const password = this.value;
    const bar = document.getElementById('strength-bar');
    const text = document.getElementById('strength-text');
    
    let strength = 0;
    if (password.length >= 8) strength += 25;
    if (password.match(/[a-z]/)) strength += 25;
    if (password.match(/[A-Z]/)) strength += 25;
    if (password.match(/[0-9]/) || password.match(/[^a-zA-Z0-9]/)) strength += 25;
    
    bar.style.width = strength + '%';
    
    if (strength <= 25) {
        bar.className = 'progress-bar bg-danger';
        text.textContent = 'Weak password';
    } else if (strength <= 50) {
        bar.className = 'progress-bar bg-warning';
        text.textContent = 'Fair password';
    } else if (strength <= 75) {
        bar.className = 'progress-bar bg-info';
        text.textContent = 'Good password';
    } else {
        bar.className = 'progress-bar bg-success';
        text.textContent = 'Strong password';
    }
    
    checkMatch();
});

// Password match checker
document.getElementById('confirm-password').addEventListener('input', checkMatch);

function checkMatch() {
    const password = document.getElementById('password').value;
    const confirm = document.getElementById('confirm-password').value;
    const error = document.getElementById('match-error');
    const confirmField = document.getElementById('confirm-password');
    const submitBtn = document.getElementById('submit-btn');
    
    if (confirm && password !== confirm) {
        confirmField.classList.add('is-invalid');
        submitBtn.disabled = true;
    } else {
        confirmField.classList.remove('is-invalid');
        submitBtn.disabled = false;
    }
}
</script>
{% endblock %}
