{% extends 'admin_base.html' %}

{% block page_title %}Email Configuration{% endblock %}

{% block admin_content %}
<h1 class="mb-4">Email Configuration</h1>

<div class="grid grid-cols-3 gap-4">
    <div class="grid-span-2">
        <div class="card mb-4">
            <div class="card-header">
                <h2 class="mb-0">SMTP Settings</h2>
            </div>
            <div class="card-body">
                <form id="smtp-settings-form" method="POST">
                    <input type="hidden" name="action" value="save">
                    
                    <div class="form-group">
                        <label for="smtp_server" class="form-label">SMTP Server</label>
                        <input type="text" class="form-control" id="smtp_server" name="smtp_server" 
                               value="{{ email_config.smtp_server or '' }}" required>
                        <small class="form-text">Hostname of your SMTP server</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="smtp_port" class="form-label">SMTP Port</label>
                        <input type="number" class="form-control" id="smtp_port" name="smtp_port" 
                               value="{{ email_config.smtp_port or 465 }}" min="1" max="65535" required>
                        <small class="form-text">Port number (465 for SSL, 587 for TLS)</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="smtp_username" class="form-label">SMTP Username</label>
                        <input type="text" class="form-control" id="smtp_username" name="smtp_username" 
                               value="{{ email_config.smtp_username or '' }}" required>
                        <small class="form-text">Username for SMTP authentication</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="smtp_password" class="form-label">SMTP Password</label>
                        <input type="password" class="form-control" id="smtp_password" name="smtp_password" 
                               value="{{ email_config.smtp_password or '' }}" required>
                        <small class="form-text">Password for SMTP authentication</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="sender_email" class="form-label">Sender Email Address</label>
                        <input type="email" class="form-control" id="sender_email" name="sender_email" 
                               value="{{ email_config.sender_email or '' }}" required>
                        <small class="form-text">Email address to send from</small>
                    </div>
                    
                    <div class="form-check mb-4">
                        <input type="checkbox" class="form-check-input" id="use_ssl" name="use_ssl" 
                               {% if email_config.use_ssl is not defined or email_config.use_ssl %}checked{% endif %}>
                        <label class="form-check-label" for="use_ssl">Use SSL/TLS for secure connection</label>
                    </div>
                    
                    <hr class="section-divider">
                    
                    <h3 class="mb-3">Admin Notifications</h3>
                    
                    <div class="form-group">
                        <label for="admin_email" class="form-label">Admin Email Address</label>
                        <input type="email" class="form-control" id="admin_email" name="admin_email" 
                               value="{{ admin_email_config.admin_email or '' }}">
                        <small class="form-text">Email for security alerts and admin notifications</small>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">Save Configuration</button>
                </form>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header">
                <h2 class="mb-0">Test Email</h2>
            </div>
            <div class="card-body">
                <form id="test-email-form" method="POST" novalidate>
                    <input type="hidden" name="action" value="test">
                    
                    <div class="form-group">
                        <label for="test_email" class="form-label">Send Test Email To</label>
                        <input type="email" class="form-control" id="test_email" name="test_email" 
                               placeholder="test@example.com" required>
                        <small class="form-text">Enter an email address to test the configuration</small>
                    </div>
                    
                    <button type="submit" class="btn btn-success" formnovalidate>Send Test Email</button>
                </form>
            </div>
        </div>
    </div>
    
    <div>
        <div class="card">
            <div class="card-header">
                <h3 class="mb-0">Information</h3>
            </div>
            <div class="card-body">
                <p><strong>Email notifications for:</strong></p>
                <ul class="list-styled">
                    <li>Client API access</li>
                    <li>Security event alerts</li>
                    <li>Authentication failures</li>
                    <li>Permission denials</li>
                </ul>
                
                <p><strong>Common SMTP Settings:</strong></p>
                <ul class="list-styled">
                    <li>Gmail: smtp.gmail.com:587</li>
                    <li>Outlook: smtp-mail.outlook.com:587</li>
                    <li>Yahoo: smtp.mail.yahoo.com:465</li>
                </ul>
                
                <div class="alert alert-info">
                    Emails are sent asynchronously with a 5-second delay to avoid blocking API responses.
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
